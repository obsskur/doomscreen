<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>/</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  background: #111; /* original background */
  overflow: hidden;
  user-select: none;
  cursor: pointer;
  position: relative;
}
#text {
  position: absolute;
  color: #eee;
  font-family: system-ui, sans-serif;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  z-index: 1000;
}
.square {
  position: absolute;
  width: 50px;
  height: 50px;
}
</style>
</head>
<body>

<div id="text">点击此处测试此程序!</div>

<script>
const squareSize = 50;
const squares = [];
let flashColor = true;
const originalBG = "#111";

// Square class
class Square {
  constructor(x = Math.random() * (window.innerWidth - squareSize), y = Math.random() * (window.innerHeight - squareSize)) {
    this.x = x;
    this.y = y;
    this.vx = (Math.random() - 0.5) * 6;
    this.vy = (Math.random() - 0.5) * 6;
    this.div = document.createElement('div');
    this.div.className = 'square';
    this.div.style.background = flashColor ? '#fff' : '#000';
    document.body.appendChild(this.div);
    this.update();
  }
  update() {
    this.x += this.vx;
    this.y += this.vy;

    if (this.x < 0 || this.x + squareSize > window.innerWidth) this.vx *= -1;
    if (this.y < 0 || this.y + squareSize > window.innerHeight) this.vy *= -1;

    this.div.style.left = this.x + 'px';
    this.div.style.top = this.y + 'px';
  }
  flash() {
    this.div.style.background = flashColor ? '#fff' : '#000';
  }
}

// Duplicate squares with random offset
function duplicateSquares() {
  const currentSquares = [...squares];
  currentSquares.forEach(sq => {
    const offsetX = (Math.random() - 0.5) * 30;
    const offsetY = (Math.random() - 0.5) * 30;
    const newSq = new Square(sq.x + offsetX, sq.y + offsetY);
    squares.push(newSq);
  });
}

// Animation loop
function animateSquares() {
  squares.forEach(sq => sq.update());
  requestAnimationFrame(animateSquares);
}

// Flashing loop
setInterval(() => {
  flashColor = !flashColor;
  squares.forEach(sq => sq.flash());
}, 1000);

// Start with 5 squares
function startSquares() {
  for (let i = 0; i < 5; i++) squares.push(new Square());
  animateSquares();
}

// Fullscreen
async function enterFullscreen() {
  try {
    const el = document.documentElement;
    if (el.requestFullscreen) await el.requestFullscreen();
    else if (el.webkitRequestFullscreen) await el.webkitRequestFullscreen();
    document.body.style.background = '#000';
    document.getElementById('text').remove();
    startSquares();
  } catch (err) {
    console.log('Fullscreen failed:', err);
  }
}

// Event handlers
function clickHandler() { duplicateSquares(); }
function keyHandler(e) { if (e.key !== 'Escape') duplicateSquares(); }

function addTriggers() {
  document.addEventListener('click', clickHandler);
  document.addEventListener('keydown', keyHandler);
}
function removeTriggers() {
  document.removeEventListener('click', clickHandler);
  document.removeEventListener('keydown', keyHandler);
}

// Reset background on fullscreen exit
document.addEventListener('fullscreenchange', () => {
  if (!document.fullscreenElement) {
    document.body.style.background = originalBG;
    addTriggers();
  }
});

// Initial setup
addTriggers();
</script>

</body>
</html>
